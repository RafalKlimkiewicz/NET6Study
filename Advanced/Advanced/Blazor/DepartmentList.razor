@page "/departments"
@page "/depts"

<CascadingValue Name="BgTheme" Value="Theme" IsFixed="false">
    <TableTemplate RowType="Department" RowData="Departments" Highlight="@(p => p.Name)" SortDirection="@(p => p.Name)">
        <Header>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>People</th>
                <th>Locations</th>
            </tr>
        </Header>
        <RowTemplate Context="d">
            <td>@d.DepartmentId</td>
            <td>@d.Name</td>
            <td>@(string.Join(", ", d.People!.Select(p => p.Surname)))</td>
            <td>@(string.Join(", ", d.People!.Select(p => p.Location!.City).Distinct()))</td>
        </RowTemplate>
    </TableTemplate>
</CascadingValue>

<SelectFilter Title="@("Theme")" Values="Themes" @bind-SelectedValue="Theme" />

<NavLink class="btn btn-primary" @onclick="HandleClick">People</NavLink>

@code {
    [Inject]
    public DataContext? Context { get; set; }

    public IEnumerable<Department>? Departments => Context?.Departments.Include(p => p.People!).ThenInclude(p => p.Location!);

    public string Theme { get; set; } = "info";

    public string[] Themes = new string[] { "primary", "info", "success" };

    [Inject]
    public NavigationManager? NavigationManager { get; set; }

    public void HandleClick() => NavigationManager?.NavigateTo("/people");
}